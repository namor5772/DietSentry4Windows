<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:DietSentry"
             x:Class="DietSentry.MainPage"
             x:Name="FoodsPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:NumericFormatConverter x:Key="NumericFormatConverter" />
            <Style
                x:Key="SelectionActionButtonStyle"
                TargetType="Button">
                <Setter
                    Property="Margin"
                    Value="{OnPlatform Android='0,0,2,2', Default='0,0,4,4'}" />
                <Setter
                    Property="WidthRequest"
                    Value="{OnPlatform Android=45.6, Default=79}" />
            </Style>
            <Style
                x:Key="TopRowButtonStyle"
                TargetType="Button">
                <Setter
                    Property="Margin"
                    Value="{OnPlatform Android='0,0,2,-4', Default='0,0,4,4'}" />
                <Setter
                    Property="WidthRequest"
                    Value="{OnPlatform Android=80.64, Default=112}" />
                <Setter
                    Property="HeightRequest"
                    Value="{OnPlatform Android=30}" />
                <Setter
                    Property="MinimumHeightRequest"
                    Value="{OnPlatform Android=30}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="*">
        <Grid
            Padding="20"
            RowDefinitions="Auto,Auto,Auto,*,Auto"
            RowSpacing="16">
            <Grid
                Grid.Row="0"
                RowDefinitions="{OnPlatform Android='Auto,Auto', Default='Auto'}"
                ColumnDefinitions="Auto,Auto,*"
                RowSpacing="{OnPlatform Android=0}"
                ColumnSpacing="12">
                <Button
                    Grid.Column="0"
                    Text="?"
                    Style="{StaticResource HelpIconButtonStyle}"
                    Clicked="OnHelpClicked"
                    Margin="{OnPlatform Android='0,2,0,0', Default='0'}"
                    VerticalOptions="Start" />
                <Label
                    Grid.Column="1"
                    Text="Foods Table"
                    FontAttributes="Bold"
                    FontSize="24"
                    VerticalOptions="Start" />
                <HorizontalStackLayout
                    Grid.Column="2"
                    Grid.Row="0"
                    IsVisible="{OnPlatform Android=True, Default=False}"
                    Spacing="8"
                    Margin="{OnPlatform Android='0,-7,0,0', Default='0'}"
                    VerticalOptions="Start">
                    <RadioButton
                        x:Name="MinModeRadioTop"
                        Content="Min"
                        GroupName="NutritionModeAndroid"
                        CheckedChanged="OnNutritionModeChanged" />
                    <RadioButton
                        x:Name="NipModeRadioTop"
                        Content="NIP"
                        GroupName="NutritionModeAndroid"
                        CheckedChanged="OnNutritionModeChanged" />
                    <RadioButton
                        x:Name="AllModeRadioTop"
                        Content="All"
                        GroupName="NutritionModeAndroid"
                        IsChecked="True"
                        CheckedChanged="OnNutritionModeChanged" />
                </HorizontalStackLayout>
                    <FlexLayout
                        Grid.Column="{OnPlatform Android=0, Default=2}"
                        Grid.ColumnSpan="{OnPlatform Android=3, Default=1}"
                        Grid.Row="{OnPlatform Android=1, Default=0}"
                        Direction="Row"
                        Wrap="Wrap"
                        AlignItems="Start"
                        JustifyContent="Start">
                        <Button
                            Text="Eaten Table"
                            BackgroundColor="{StaticResource PrimaryDark}"
                            TextColor="{StaticResource White}"
                            Clicked="OnEatenLogClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Weight Table"
                            BackgroundColor="{StaticResource PrimaryDark}"
                            TextColor="{StaticResource White}"
                            Clicked="OnWeightTableClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Add Solid"
                            Clicked="OnInsertFoodClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Add Liquid"
                            Clicked="OnInsertLiquidFoodClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Add Recipe"
                            Clicked="OnAddRecipeClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="JSON"
                            Clicked="OnAddFoodByJsonClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Export db"
                            Clicked="OnExportDbClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                        <Button
                            Text="Import db"
                            Clicked="OnImportDbClicked"
                            Style="{StaticResource TopRowButtonStyle}" />
                    </FlexLayout>
            </Grid>

            <HorizontalStackLayout
                Grid.Row="1"
                Spacing="8"
                Margin="{OnPlatform Android='0,-16,0,0', Default='0'}"
                IsVisible="{OnPlatform Android=False, Default=True}">
                <RadioButton
                    x:Name="MinModeRadio"
                    Content="Min"
                    GroupName="NutritionMode"
                    CheckedChanged="OnNutritionModeChanged" />
                <RadioButton
                    x:Name="NipModeRadio"
                    Content="NIP"
                    GroupName="NutritionMode"
                    CheckedChanged="OnNutritionModeChanged" />
                <RadioButton
                    x:Name="AllModeRadio"
                    Content="All"
                    GroupName="NutritionMode"
                    IsChecked="True"
                    CheckedChanged="OnNutritionModeChanged" />
            </HorizontalStackLayout>

            <HorizontalStackLayout
                Grid.Row="2"
                Spacing="8"
                Margin="{OnPlatform Android='0,-25,0,0', Default='0'}">
                <Entry
                    x:Name="FoodFilterEntry"
                    Placeholder="Enter food filter text"
                    WidthRequest="260"
                    HorizontalOptions="Start"
                    Completed="OnFoodFilterCompleted" />
                <Button
                    Text="Clear"
                    HeightRequest="{OnPlatform Android=30}"
                    MinimumHeightRequest="{OnPlatform Android=30}"
                    Clicked="OnClearFilterClicked" />
            </HorizontalStackLayout>

            <Frame
                Grid.Row="3"
                BorderColor="LightGray"
                Padding="10"
                VerticalOptions="{OnPlatform Android=FillAndExpand, Default=FillAndExpand}"
                HorizontalOptions="FillAndExpand">
                <Grid RowDefinitions="*">
                <CollectionView
                    x:Name="FoodsCollectionView"
                    Grid.Row="0"
                    ItemsSource="{Binding Foods}"
                    ItemSizingStrategy="MeasureAllItems"
                    SelectionMode="Single"
                    SelectionChanged="OnFoodSelectionChanged"
                    VerticalOptions="FillAndExpand"
                    HorizontalOptions="FillAndExpand">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="local:Food">
                            <VerticalStackLayout Spacing="4" Padding="4">
                                <Label Text="{Binding FoodDescription}">
                                    <Label.Triggers>
                                        <DataTrigger
                                            TargetType="Label"
                                            Binding="{Binding Source={x:Reference FoodsPage}, Path=ShowNipOnly}"
                                            Value="True">
                                            <Setter Property="FontAttributes" Value="Bold" />
                                        </DataTrigger>
                                        <DataTrigger
                                            TargetType="Label"
                                            Binding="{Binding Source={x:Reference FoodsPage}, Path=ShowAll}"
                                            Value="True">
                                            <Setter Property="FontAttributes" Value="Bold" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                                <Grid
                                    ColumnDefinitions="Auto,*"
                                    RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                                    ColumnSpacing="12"
                                    RowSpacing="2"
                                    IsVisible="{Binding Source={x:Reference FoodsPage}, Path=ShowNipOnly}">
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Text="Energy (kJ):" />
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Text="{Binding Energy, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Text="Protein (g):" />
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Text="{Binding Protein, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Text="Fat, Total (g):" />
                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Text="{Binding FatTotal, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Text="- Saturated (g):" />
                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        Text="{Binding SaturatedFat, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="4"
                                        Grid.Column="0"
                                        Text="Carbohydrate (g):" />
                                    <Label
                                        Grid.Row="4"
                                        Grid.Column="1"
                                        Text="{Binding Carbohydrate, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="5"
                                        Grid.Column="0"
                                        Text="- Sugars (g):" />
                                    <Label
                                        Grid.Row="5"
                                        Grid.Column="1"
                                        Text="{Binding Sugars, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="6"
                                        Grid.Column="0"
                                        Text="Sodium (mg):" />
                                    <Label
                                        Grid.Row="6"
                                        Grid.Column="1"
                                        Text="{Binding Sodium, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                </Grid>
                                <Grid
                                    ColumnDefinitions="Auto,*"
                                    RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                                    ColumnSpacing="12"
                                    RowSpacing="2"
                                    IsVisible="{Binding Source={x:Reference FoodsPage}, Path=ShowAll}">
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Text="Energy (kJ):" />
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Text="{Binding Energy, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Text="Protein (g):" />
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Text="{Binding Protein, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Text="Fat, Total (g):" />
                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Text="{Binding FatTotal, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Text="- Saturated (g):" />
                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        Text="{Binding SaturatedFat, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="4"
                                        Grid.Column="0"
                                        Text="- Trans (mg):" />
                                    <Label
                                        Grid.Row="4"
                                        Grid.Column="1"
                                        Text="{Binding TransFat, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="5"
                                        Grid.Column="0"
                                        Text="- Polyunsaturated (g):" />
                                    <Label
                                        Grid.Row="5"
                                        Grid.Column="1"
                                        Text="{Binding PolyunsaturatedFat, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="6"
                                        Grid.Column="0"
                                        Text="- Monounsaturated (g):" />
                                    <Label
                                        Grid.Row="6"
                                        Grid.Column="1"
                                        Text="{Binding MonounsaturatedFat, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="7"
                                        Grid.Column="0"
                                        Text="Carbohydrate (g):" />
                                    <Label
                                        Grid.Row="7"
                                        Grid.Column="1"
                                        Text="{Binding Carbohydrate, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="8"
                                        Grid.Column="0"
                                        Text="- Sugars (g):" />
                                    <Label
                                        Grid.Row="8"
                                        Grid.Column="1"
                                        Text="{Binding Sugars, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="9"
                                        Grid.Column="0"
                                        Text="Sodium (mg):" />
                                    <Label
                                        Grid.Row="9"
                                        Grid.Column="1"
                                        Text="{Binding Sodium, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="10"
                                        Grid.Column="0"
                                        Text="Dietary Fibre (g):" />
                                    <Label
                                        Grid.Row="10"
                                        Grid.Column="1"
                                        Text="{Binding DietaryFibre, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="11"
                                        Grid.Column="0"
                                        Text="Calcium (mg):" />
                                    <Label
                                        Grid.Row="11"
                                        Grid.Column="1"
                                        Text="{Binding CalciumCa, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="12"
                                        Grid.Column="0"
                                        Text="Potassium (mg):" />
                                    <Label
                                        Grid.Row="12"
                                        Grid.Column="1"
                                        Text="{Binding PotassiumK, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="13"
                                        Grid.Column="0"
                                        Text="Thiamin B1 (mg):" />
                                    <Label
                                        Grid.Row="13"
                                        Grid.Column="1"
                                        Text="{Binding ThiaminB1, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="14"
                                        Grid.Column="0"
                                        Text="Riboflavin B2 (mg):" />
                                    <Label
                                        Grid.Row="14"
                                        Grid.Column="1"
                                        Text="{Binding RiboflavinB2, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="15"
                                        Grid.Column="0"
                                        Text="Niacin B3 (mg):" />
                                    <Label
                                        Grid.Row="15"
                                        Grid.Column="1"
                                        Text="{Binding NiacinB3, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="16"
                                        Grid.Column="0"
                                        Text="Folate (ug):" />
                                    <Label
                                        Grid.Row="16"
                                        Grid.Column="1"
                                        Text="{Binding Folate, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="17"
                                        Grid.Column="0"
                                        Text="Iron (mg):" />
                                    <Label
                                        Grid.Row="17"
                                        Grid.Column="1"
                                        Text="{Binding IronFe, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="18"
                                        Grid.Column="0"
                                        Text="Magnesium (mg):" />
                                    <Label
                                        Grid.Row="18"
                                        Grid.Column="1"
                                        Text="{Binding MagnesiumMg, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="19"
                                        Grid.Column="0"
                                        Text="Vitamin C (mg):" />
                                    <Label
                                        Grid.Row="19"
                                        Grid.Column="1"
                                        Text="{Binding VitaminC, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="20"
                                        Grid.Column="0"
                                        Text="Caffeine (mg):" />
                                    <Label
                                        Grid.Row="20"
                                        Grid.Column="1"
                                        Text="{Binding Caffeine, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="21"
                                        Grid.Column="0"
                                        Text="Cholesterol (mg):" />
                                    <Label
                                        Grid.Row="21"
                                        Grid.Column="1"
                                        Text="{Binding Cholesterol, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Label
                                        Grid.Row="22"
                                        Grid.Column="0"
                                        Text="Alcohol (g):" />
                                    <Label
                                        Grid.Row="22"
                                        Grid.Column="1"
                                        Text="{Binding Alcohol, Converter={StaticResource NumericFormatConverter}}"
                                        HorizontalTextAlignment="End" />
                                    <Grid
                                        Grid.Row="23"
                                        Grid.ColumnSpan="2"
                                        ColumnDefinitions="Auto,*"
                                        ColumnSpacing="6">
                                        <Label
                                            Grid.Column="0"
                                            Text="Notes:" />
                                        <Label
                                            Grid.Column="1"
                                            Text="{Binding Notes}"
                                            LineBreakMode="WordWrap"
                                            HorizontalOptions="FillAndExpand"
                                            VerticalOptions="Start" />
                                    </Grid>
                                </Grid>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Frame>

        <Frame
            Grid.Row="4"
            BorderColor="LightGray"
            Padding="10"
            IsVisible="{Binding ShowSelectionPanel}">
            <VerticalStackLayout Spacing="8">
                <Label
                    Text="{Binding SelectedFoodDescription}"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Start"
                    JustifyContent="Center">
                    <Button
                        Text="LOG"
                        Clicked="OnLogClicked"
                        Style="{StaticResource SelectionActionButtonStyle}" />
                    <Button
                        Text="Edit"
                        Clicked="OnEditFoodClicked"
                        Style="{StaticResource SelectionActionButtonStyle}" />
                    <Button
                        Text="Copy"
                        Clicked="OnCopyFoodClicked"
                        Style="{StaticResource SelectionActionButtonStyle}" />
                    <Button
                        Text="Convert"
                        Clicked="OnConvertClicked"
                        WidthRequest="{OnPlatform Android=58, Default=79}"
                        Style="{StaticResource SelectionActionButtonStyle}" />
                    <Button
                        Text="Delete"
                        Clicked="OnDeleteClicked"
                        WidthRequest="{OnPlatform Android=54.72, Default=79}"
                        Style="{StaticResource SelectionActionButtonStyle}" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>

    </Grid>

    <Grid
        BackgroundColor="Transparent"
        Grid.Row="0"
        IsVisible="{Binding ShowLogPanel}"
        ZIndex="{OnPlatform Android=0, Default=10}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnLogBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=291.2, Default=364}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    x:Name="LogFoodNameLabel"
                    FontAttributes="Bold"
                    FontSize="18" />
                <Grid
                    ColumnDefinitions="Auto,Auto,Auto,*"
                    ColumnSpacing="8"
                    RowDefinitions="Auto,Auto"
                    RowSpacing="8">
                    <Entry
                        x:Name="LogAmountEntry"
                        Placeholder="Amount"
                        Keyboard="Numeric"
                        WidthRequest="95"
                        HorizontalOptions="FillAndExpand"
                        Grid.Column="0" />
                    <Label
                        x:Name="LogFoodUnitLabel"
                        VerticalOptions="Center"
                        Grid.Column="1" />
                    <DatePicker
                        x:Name="LogDatePicker"
                        VerticalOptions="Center"
                        Grid.Column="2" />
                    <TimePicker
                        x:Name="LogTimePicker"
                        VerticalOptions="Center"
                        Format="HH:mm"
                        HorizontalOptions="Start"
                        MinimumWidthRequest="112"
                        Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="4" />
                </Grid>
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="Confirm"
                        Clicked="OnLogConfirmClicked"
                        Margin="0,0,4,4" />
                    <Button
                        Text="Cancel"
                        Clicked="OnLogCancelClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        Grid.Row="0"
        IsVisible="{Binding ShowConvertPanel}"
        ZIndex="{OnPlatform Android=0, Default=10}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnConvertBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=291.2, Default=364}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    x:Name="ConvertFoodNameLabel"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center"
                    LineBreakMode="WordWrap" />
                <Label
                    Text="Enter density to convert this liquid into a solid food." />
                <Grid
                    ColumnDefinitions="*,Auto"
                    ColumnSpacing="8">
                    <Entry
                        x:Name="ConvertDensityEntry"
                        Placeholder="Density"
                        Keyboard="Numeric"
                        Grid.Column="0" />
                    <Label
                        Text="g/mL"
                        VerticalOptions="Center"
                        Grid.Column="1" />
                </Grid>
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="Confirm"
                        Clicked="OnConvertConfirmClicked"
                        Margin="0,0,4,4" />
                    <Button
                        Text="Cancel"
                        Clicked="OnConvertCancelClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        Grid.Row="0"
        IsVisible="{Binding ShowDeletePanel}"
        ZIndex="{OnPlatform Android=0, Default=10}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnDeleteBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=291.2, Default=364}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Delete Food?"
                    TextColor="Red"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="Are you sure you want to delete:"
                    HorizontalTextAlignment="Center" />
                <Label
                    x:Name="DeleteFoodDescriptionLabel"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="Confirm"
                        Clicked="OnDeleteConfirmClicked"
                        Margin="0,0,4,4" />
                    <Button
                        Text="Cancel"
                        Clicked="OnDeleteCancelClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        Grid.Row="0"
        IsVisible="{Binding ShowExportPanel}"
        ZIndex="{OnPlatform Android=0, Default=10}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnExportDbBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=291.2, Default=364}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Export Database?"
                    TextColor="Red"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="This will overwrite:"
                    HorizontalTextAlignment="Center" />
                <Label
                    x:Name="ExportTargetPathLabel"
                    LineBreakMode="WordWrap"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="THINK CAREFULLY BEFORE CONFIRMING!"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="Confirm"
                        Clicked="OnExportDbConfirmClicked"
                        Margin="0,0,4,4" />
                    <Button
                        Text="Cancel"
                        Clicked="OnExportDbCancelClicked"
                        Margin="0,0,4,4" />
                <Button
                    Text="Change folder"
                    Clicked="OnChangeExportFolderClicked"
                    Margin="0,0,4,4"
                    IsVisible="{OnPlatform Android=True, WinUI=True, Default=False}" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        Grid.Row="0"
        IsVisible="{Binding ShowImportPanel}"
        ZIndex="{OnPlatform Android=0, Default=10}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnImportDbBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=291.2, Default=364}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Import Database?"
                    TextColor="Red"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="This will replace the current database with:"
                    HorizontalTextAlignment="Center" />
                <Label
                    x:Name="ImportSourcePathLabel"
                    LineBreakMode="WordWrap"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="THINK CAREFULLY BEFORE CONFIRMING!"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="Confirm"
                        Clicked="OnImportDbConfirmClicked"
                        Margin="0,0,4,4" />
                    <Button
                        Text="Cancel"
                        Clicked="OnImportDbCancelClicked"
                        Margin="0,0,4,4" />
                <Button
                    Text="Change folder"
                    Clicked="OnChangeImportFolderClicked"
                    Margin="0,0,4,4"
                    IsVisible="{OnPlatform Android=True, WinUI=True, Default=False}" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        x:Name="InvalidAmountOverlay"
        Grid.Row="0"
        IsVisible="False"
        ZIndex="{OnPlatform Android=0, Default=20}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnInvalidAmountBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=256, Default=320}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Invalid Amount"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    Text="Enter a valid amount."
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="OK"
                        Clicked="OnInvalidAmountOkClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        x:Name="NotAvailableOverlay"
        Grid.Row="0"
        IsVisible="False"
        ZIndex="{OnPlatform Android=0, Default=20}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnNotAvailableBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=256, Default=320}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Not available"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    x:Name="NotAvailableMessageLabel"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="OK"
                        Clicked="OnNotAvailableOkClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        BackgroundColor="Transparent"
        x:Name="InvalidDensityOverlay"
        Grid.Row="0"
        IsVisible="False"
        ZIndex="{OnPlatform Android=0, Default=20}">
        <BoxView
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnInvalidDensityBackdropTapped" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Frame
            Padding="16"
            CornerRadius="12"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="{OnPlatform Android=256, Default=320}"
            HasShadow="True">
            <Frame.Shadow>
                <Shadow
                    Brush="#40000000"
                    Offset="0,8"
                    Radius="12"
                    Opacity="0.6" />
            </Frame.Shadow>
            <VerticalStackLayout Spacing="12">
                <Label
                    Text="Invalid density"
                    FontAttributes="Bold"
                    FontSize="18"
                    HorizontalTextAlignment="Center" />
                <Label
                    x:Name="InvalidDensityMessageLabel"
                    HorizontalTextAlignment="Center" />
                <FlexLayout
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Center"
                    JustifyContent="Center">
                    <Button
                        Text="OK"
                        Clicked="OnInvalidDensityOkClicked"
                        Margin="0,0,4,4" />
                </FlexLayout>
            </VerticalStackLayout>
        </Frame>
    </Grid>

    <Grid
        x:Name="HelpOverlay"
        IsVisible="False"
        ZIndex="{OnPlatform Android=0, Default=30}"
        BackgroundColor="Transparent"
        VerticalOptions="FillAndExpand"
        HorizontalOptions="FillAndExpand"
        RowDefinitions="*,Auto">
        <BoxView
            Grid.Row="0"
            BackgroundColor="Transparent"
            Color="#80000000">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnHelpDismissed" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <Border
            x:Name="HelpSheet"
            Grid.Row="1"
            BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
            Padding="20,16"
            StrokeThickness="0">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="16,16,0,0" />
            </Border.StrokeShape>
            <Grid RowDefinitions="Auto,*" RowSpacing="12">
                <Grid ColumnDefinitions="*,Auto">
                    <Label
                        Text="{x:Static local:HelpContent.FoodsTableTitle}"
                        FontAttributes="Bold"
                        FontSize="18"
                        VerticalOptions="Center" />
                    <Button
                        Grid.Column="1"
                        Text="Close"
                        Clicked="OnHelpDismissed"
                        Padding="6,2"
                        FontSize="12"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}" />
                </Grid>
                <local:MarkdownView
                    Grid.Row="1"
                    MarkdownText="{x:Static local:HelpContent.FoodsTableBody}"
                    VerticalOptions="FillAndExpand" />
            </Grid>
        </Border>
    </Grid>

    </Grid>

</ContentPage>
