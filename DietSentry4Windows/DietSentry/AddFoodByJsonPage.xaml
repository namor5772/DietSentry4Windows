<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:DietSentry"
             x:Class="DietSentry.AddFoodByJsonPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style
                x:Key="TopRowButtonStyle"
                TargetType="Button">
                <Setter
                    Property="Margin"
                    Value="0,0,4,4" />
                <Setter
                    Property="WidthRequest"
                    Value="{OnPlatform Android=89.6, Default=112}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid
            Padding="20"
            RowDefinitions="Auto,*"
            RowSpacing="16">
            <Grid
                Grid.Row="0"
                ColumnDefinitions="Auto,Auto,*"
                ColumnSpacing="12">
                <Button
                    Grid.Column="0"
                    Text="?"
                    Style="{StaticResource HelpIconButtonStyle}"
                    Clicked="OnHelpClicked"
                    VerticalOptions="Start" />
                <Label
                    Grid.Column="1"
                    Text="Add Food using JSON"
                    FontAttributes="Bold"
                    FontSize="24"
                    VerticalOptions="Start" />
                <FlexLayout
                    Grid.Column="2"
                    Direction="Row"
                    Wrap="Wrap"
                    AlignItems="Start"
                    JustifyContent="Start">
                    <Button
                        Text="Foods Table"
                        BackgroundColor="{StaticResource PrimaryDark}"
                        TextColor="{StaticResource White}"
                        Clicked="OnBackClicked"
                        Style="{StaticResource TopRowButtonStyle}" />
                    <Button
                        Text="Confirm"
                        Clicked="OnConfirmClicked"
                        Style="{StaticResource TopRowButtonStyle}" />
                </FlexLayout>
            </Grid>

            <Editor
                Grid.Row="1"
                x:Name="JsonEditor"
                Placeholder="Paste JSON here"
                VerticalOptions="FillAndExpand"
                HorizontalOptions="FillAndExpand" />
        </Grid>

        <Grid
            x:Name="MissingDescriptionOverlay"
            IsVisible="False">
            <BoxView Color="#80000000">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnMissingDescriptionBackdropTapped" />
                </BoxView.GestureRecognizers>
            </BoxView>
            <Frame
                Padding="16"
                CornerRadius="12"
                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                WidthRequest="320"
                HasShadow="True">
                <Frame.Shadow>
                    <Shadow
                        Brush="#40000000"
                        Offset="0,8"
                        Radius="12"
                        Opacity="0.6" />
                </Frame.Shadow>
                <VerticalStackLayout Spacing="12">
                    <Label
                        Text="Missing description"
                        FontAttributes="Bold"
                        FontSize="18"
                        HorizontalTextAlignment="Center" />
                    <Label
                        x:Name="MissingDescriptionMessageLabel"
                        HorizontalTextAlignment="Center" />
                    <FlexLayout
                        Direction="Row"
                        Wrap="Wrap"
                        AlignItems="Center"
                        JustifyContent="Center">
                        <Button
                            Text="OK"
                            Clicked="OnMissingDescriptionOkClicked"
                            Margin="0,0,4,4" />
                    </FlexLayout>
                </VerticalStackLayout>
            </Frame>
        </Grid>

        <Grid
            x:Name="InvalidJsonOverlay"
            IsVisible="False">
            <BoxView Color="#80000000">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnInvalidJsonBackdropTapped" />
                </BoxView.GestureRecognizers>
            </BoxView>
            <Frame
                Padding="16"
                CornerRadius="12"
                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                WidthRequest="320"
                HasShadow="True">
                <Frame.Shadow>
                    <Shadow
                        Brush="#40000000"
                        Offset="0,8"
                        Radius="12"
                        Opacity="0.6" />
                </Frame.Shadow>
                <VerticalStackLayout Spacing="12">
                    <Label
                        Text="Invalid JSON"
                        FontAttributes="Bold"
                        FontSize="18"
                        HorizontalTextAlignment="Center" />
                    <Label
                        x:Name="InvalidJsonMessageLabel"
                        HorizontalTextAlignment="Center" />
                    <FlexLayout
                        Direction="Row"
                        Wrap="Wrap"
                        AlignItems="Center"
                        JustifyContent="Center">
                        <Button
                            Text="OK"
                            Clicked="OnInvalidJsonOkClicked"
                            Margin="0,0,4,4" />
                    </FlexLayout>
                </VerticalStackLayout>
            </Frame>
        </Grid>

        <Grid
            x:Name="HelpOverlay"
            IsVisible="False"
            BackgroundColor="#80000000"
            RowDefinitions="*,Auto">
            <BoxView
                Grid.Row="0"
                BackgroundColor="Transparent">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnHelpDismissed" />
                </BoxView.GestureRecognizers>
            </BoxView>
            <Border
                x:Name="HelpSheet"
                Grid.Row="1"
                BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                Padding="20,16"
                StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16,16,0,0" />
                </Border.StrokeShape>
                <Grid RowDefinitions="Auto,*" RowSpacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label
                            Text="{x:Static local:HelpContent.AddFoodByJsonTitle}"
                            FontAttributes="Bold"
                            FontSize="18"
                            VerticalOptions="Center" />
                        <Button
                            Grid.Column="1"
                            Text="Close"
                            Clicked="OnHelpDismissed"
                            Padding="6,2"
                            FontSize="12"
                            BackgroundColor="Transparent"
                            TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}" />
                    </Grid>
                    <local:MarkdownView
                        Grid.Row="1"
                        MarkdownText="{x:Static local:HelpContent.JsonFoodBody}"
                        VerticalOptions="FillAndExpand" />
                </Grid>
            </Border>
        </Grid>
    </Grid>

</ContentPage>
